<script src="params.js"></script>
<script src="helpers.js"></script>
<script src="lstm.js"></script>
<script src="images.js"></script>
<script>

var lineheight = 28, 
    hiddensize = 50;

codec = [""," ","!","\"","#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","¡","¢","£","§","©","«","®","°","¶","»","¿","À","Â","Ä","Æ","Ç","È","É","Ê","Ë","Î","Ï","Ô","Ö","Ù","Û","Ü","ß","à","â","ä","æ","ç","è","é","ê","ë","î","ï","ô","ö","÷","ù","û","ü","ÿ","Œ","œ","Ÿ","†","‡","•","‣","‹","›","€","∙","▪","▫","◦"]

net = new SequenceRecognizer(lineheight, hiddensize, codec);

var parallel = net.lstm.nets[0],
    softmax  = net.lstm.nets[1],
    fwd      = parallel.nets[0],
    rev      = parallel.nets[1].net;


var dict = '';
for(var i = 32; i < 126; i++){
    if(i == 92 || i == 34 || i == 39 || i == 60) continue;
    dict += String.fromCharCode(i)
}

function vecparse(str){
	var arr = new Float32Array(str.length);
    for(var i = 0; i < str.length; i++)
        arr[i] = 2 * encGamut * dict.indexOf(str[i]) / (dict.length - 1) - encGamut;
    return arr;
}

fwd.WGI = fwdWGI.map(vecparse)
fwd.WGF = fwdWGF.map(vecparse)
fwd.WGO = fwdWGO.map(vecparse)
fwd.WCI = fwdWCI.map(vecparse)
fwd.WIP = vecparse(fwdWIP);
fwd.WFP = vecparse(fwdWFP);
fwd.WOP = vecparse(fwdWOP);

rev.WGI = revWGI.map(vecparse)
rev.WGF = revWGF.map(vecparse)
rev.WGO = revWGO.map(vecparse)
rev.WCI = revWCI.map(vecparse)
rev.WIP = vecparse(revWIP);
rev.WFP = vecparse(revWFP);
rev.WOP = vecparse(revWOP);

softmax.W = softW.map(vecparse)
softmax.B = vecparse(softB);


console.time('recognition start');
[img010001, img010002, img010003, img010004, img010005, img010006, img010007, img010008, img010009, img01000a, img01000b, img01000c, img01000d, img01000e, img01000f, img010010, img010011, img010012, img010013, img010014, img010015, img010016, img010017, img010018, img010019, img01001a].forEach(function(image){
    console.log(net.predictString(image))
})
console.timeEnd('recognition start')
</script>